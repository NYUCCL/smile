#!/bin/bash

ENV_FILE='env/.env.git.local'

echo "Regenerating local environment file based on git info $ENV_FILE"
echo "# DO NOT EDIT THIS FILE IT IS AUTOMATICALLY GENERATED" > $ENV_FILE
echo "# this file is automatically generated by the post-commit hook (see scripts/post-commit)." >> $ENV_FILE
echo "" >> $ENV_FILE

PROJECT_NAME=$(basename $(git remote get-url origin) .git)
echo "VITE_PROJECT_NAME      = $PROJECT_NAME" >> $ENV_FILE

HASH=$(git rev-parse --short HEAD)
echo "VITE_GIT_HASH          = $HASH" >> $ENV_FILE

echo 'VITE_GIT_REPO_NAME     = ${VITE_PROJECT_NAME}' >> $ENV_FILE

OWNER=$(basename $(dirname $(git remote get-url origin)))
echo "VITE_GIT_OWNER         = ${OWNER}" >> $ENV_FILE

BRANCH=$(git rev-parse --abbrev-ref HEAD)
echo "VITE_GIT_BRANCH_NAME   = $BRANCH" >> $ENV_FILE

MSG=$(git log -1 --pretty=%B)
echo "VITE_GIT_LAST_MSG      = $MSG" >> $ENV_FILE

echo 'VITE_DEPLOY_BASE_PATH   =  "/${VITE_GIT_OWNER}/${VITE_GIT_REPO_NAME}/${VITE_GIT_BRANCH_NAME}/"' >> $ENV_FILE

echo "" >> $ENV_FILE
echo "# this port might not be correct, but it doesn't really matter" >> $ENV_FILE
echo "VITE_PORT_NUM           =  3000" >> $ENV_FILE
echo 'VITE_DEPLOY_URL         =  "http://localhost:${VITE_PORT_NUM}${VITE_DEPLOY_BASE_PATH}"' >> $ENV_FILE
